# 97.获取风场数据.103
## <a name="index"></a> 目录
- [引子](#start)
- [安装 ecCodes](#ecCodes)
- [执行脚本](#run)
- [数据生成](#data)
- [参考资料](#reference)

## <a name="start"></a> 引子
了解 [OpenGL 基础][url-pre]之后，接[文章][url-base]顺序，尝试换个最近的时间看看效果，没想到又遇到问题。

- 系统：MacOS
- 版本：11.6

## <a name="ecCodes"></a> 安装 ecCodes
在文章的[示例源库][url-1]的说明中，首先要安装 ecCodes ，尝试使用 HomeBrew 按照，但试了不行。于是就按照 [ecCodes][url-5] 源库的介绍本地进行编译安装。

在进行第 4 步的时候，碰到了问题：

> No CMAKE_Fortran_COMPILER could be found.

查询资料说是缺少 `gfortran` ，可以使用命令查看是否已安装：
```shell
which gfortran
```
有好几种[安装方式][url-3]，这里使用的是[下载安装包][url-2]。

解决这个问题后接着按照指导成功的进行了编译安装，版本是 2.23.0 。

## <a name="run"></a> 执行脚本
执行脚本的时候，出现了错误提示：

> grib_set: command not found  grib_dump: command not found

但在前面安装的文件夹的 `bin` 目录下是找到了 grib_set 的执行文件。由于推断是没有注册到全局路径中。

查看 ecCodes 安装路径是否注册到全局路径中：
```shell
echo $PATH
```
这里碰到的问题是没有注册到全局路径中，设置方式可参考[这里][url-6]。

修改示例：
```
vim ./.bash_profile
```
进入到编辑模式后，添加下面的内容：
```
export ECCODE_HOME=/xx/xx/xx/xx/eccodesbuild/bin
export PATH=$PATH:$ECCODE_HOME
```
保存后，使其生效
```
source ./.bash_profile
```
想知道是否生效了，试试指令 `grib_set -h` ，如果发现没有效果，有可能跟使用的 shell 端有关，可参看[这里][url-4]。

## <a name="data"></a> 数据生成
脚本可以正常执行了，但生成的数据不对：
> undefined:1

> {"u":,"v":}

查看源库的 issues 也发现这个[问题][url-7]，试了里面的一些方法，发现这个 [pull][url-7] 的修改可以正常的运行。于是就 fork 了一下把这个修改的内容弄过来了，改了些数据，见 [XXHolic/webgl-wind][url-9] 。

<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="reference"></a> 参考资料
- [How I built a wind map with WebGL][url-base]

[url-pre]:https://github.com/XXHolic/blog/issues/102
[url-base]:https://github.com/XXHolic/blog/issues/101
[url-1]:https://github.com/mapbox/webgl-wind
[url-2]:https://github.com/fxcoudert/gfortran-for-macOS/releases
[url-3]:https://gcc.gnu.org/wiki/GFortranBinaries
[url-4]:https://www.jianshu.com/p/407f0f9d8203
[url-5]:https://github.com/ecmwf/eccodes
[url-6]:https://www.cnblogs.com/shineqiujuan/p/4693404.html
[url-7]:https://github.com/mapbox/webgl-wind/issues/15
[url-8]:https://github.com/mapbox/webgl-wind/pull/18
[url-9]:https://github.com/XXHolic/webgl-wind

[url-local-rail]:./images/n/rail.png

<details>
<summary>:wastebasket:</summary>

![n-poster][url-local-poster]

</details>

[url-book]:https://book.douban.com/subject/26916012/
[url-local-poster]:./images/n/poster.jpg
