# 92.Learn D3ï¼šJoins.98

## <a name="start"></a> å¼•å­
ç»§ [Learn D3: Animation][url-pre] ç¬¬ä¸ƒç¯‡ï¼Œåªæ˜¯è‹±æ–‡ç¿»è¯‘ï¼Œå¯ä¿®æ”¹ä»£ç çš„éƒ¨åˆ†ç”¨é™æ€å›¾ç‰‡æ›¿ä»£äº†ï¼Œæƒ³è¦å®æ—¶äº¤äº’è¯·é˜…è¯»åŸæ–‡ã€‚

- åŸæ–‡ï¼š[Learn D3: Joins][url-1]
- ç‰ˆæœ¬ï¼šPublished Mar 24, 2020

## <a name="title1"></a> æ­£æ–‡
å¦‚æœä½ ç†Ÿæ‚‰æ­¤æ•™ç¨‹ä¸­çš„ D3 ï¼Œä½ å¯èƒ½ä¼šæƒŠè®¶äº D3 é€‰æ‹©å™¨è¢«æåŠçš„å¦‚æ­¤ä¹‹å°‘ã€‚

é‚£æ˜¯å› ä¸ºä½ å¯èƒ½ä¸éœ€è¦å®ƒä»¬ï¼

D3 é€‰æ‹©å™¨é€‚ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å®šä½ï¼šå¿«é€Ÿï¼ŒåŠ¨æ€å›¾è¡¨çš„å¢é‡æ›´æ–°ã€‚å¦‚æœä½ å…³æ³¨çš„æ˜¯é™æ€å›¾è¡¨ï¼Œæˆ–è€…æ¯å¸§éƒ½å¯ä»¥ä»å¤´å¼€å§‹é‡æ–°ç»˜åˆ¶çš„å›¾è¡¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½æ›´å–œæ¬¢ä¸åŒçš„æŠ½è±¡ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ æƒ³è¦åŠ¨ç”»è¿‡æ¸¡æˆ–ä»ç°ä»£æµè§ˆå™¨ä¸­æ¦¨å–æœ€ä½³æ€§èƒ½ï¼Œé€‰æ‹©å™¨é€‚åˆä½ ã€‚

ï¼ˆå³ä½¿ä½ å†³å®šä¸ä½¿ç”¨é€‰æ‹©å™¨ï¼Œè¯·è®°ä½ D3 è¿˜æœ‰å¤§é‡å…¶å®ƒæœ‰ç”¨çš„å¯è§†åŒ–å·¥å…·ã€‚æ¯”ä¾‹å°ºã€å½¢çŠ¶ã€æ’å€¼å™¨ã€é¢œè‰²ã€åœ°å›¾æŠ•å½±å’Œè®¸å¤šå…¶å®ƒåŠŸèƒ½å¯ç”¨äº Canvasã€WebGL æˆ–å…¶å®ƒ DOM æŠ½è±¡ï¼Œå¦‚ Observable çš„ HTML æ ‡è®°æ¨¡æ¿æ–‡å­—ã€React æˆ– Svelte ã€‚D3 è¿˜å¯ä»¥ä½¿ç”¨ç»Ÿè®¡ã€åˆ†ç»„å’Œèšåˆã€æ—¶é—´åºåˆ—å’Œè§£æçš„æ–¹æ³•ï¼ŒååŠ©æ•°æ®æ¸…ç†å’Œåˆ†æã€‚ï¼‰

æœ¬è´¨ä¸Šï¼ŒD3 é€‰æ‹©å™¨æŒ‡å®šçš„æ˜¯*è½¬æ¢*è€Œä¸æ˜¯*è¡¨ç¤º*ã€‚ä½ å¯ä»¥æŒ‡å®šå°†å½“å‰çŠ¶æ€è½¬æ¢ä¸ºæ‰€éœ€çŠ¶æ€æ‰€åšçš„æ›´æ”¹ï¼ˆæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤ï¼‰ï¼Œè€Œä¸æ˜¯è¡¨ç¤ºå›¾è¡¨ï¼ˆDOMï¼‰çš„æ‰€éœ€çŠ¶æ€ã€‚è¿™æœ‰æ—¶å¾ˆä¹å‘³ï¼Œä½†å…è®¸ä½ è®¾ç½®è¿‡æ¸¡åŠ¨ç”»ï¼Œå¹¶æœ€å°åŒ–å¯¹ DOM çš„æ›´æ”¹ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åšã€‚

å‡è®¾æˆ‘ä»¬æƒ³æ˜¾ç¤ºå­—æ¯è¡¨ä¸­çš„å­—æ¯ã€‚è™½ç„¶ä¸æ˜¯å¾ˆç›´è§‚ï¼Œä½†æˆ‘ä»¬å°†ä¿æŒç®€å•ï¼Œä»¥ä¸“æ³¨äºæŠ€æœ¯(æœ‰å…³å®é™…çš„ç¤ºä¾‹ï¼Œè¯·å‚è§ [D3 å›¾åº“][url-2] çš„åŠ¨ç”»å’Œäº¤äº’éƒ¨åˆ†ã€‚ï¼‰

![92-1][url-local-1]

è¿™ä¸ªå›¾è¡¨æ˜¯é™æ€çš„ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨æ¯æ¬¡å•å…ƒè¿è¡Œæ—¶ä»å¤´å¼€å§‹åˆ›å»ºçš„ï¼Œè¿™ä½¿å¾— D3 ä»£ç åœ¨æœ¬è´¨ä¸Šç­‰åŒäº HTML æ–‡æœ¬ã€‚

![92-2][url-local-2]

é‚£ä¹ˆï¼Œä½•å¿…è¦ç”¨é€‰æ‹©å™¨å‘¢ï¼Ÿå¯¹ï¼Œå¯¹äºé™æ€å›¾è¡¨ï¼Œæ²¡æœ‰ä»€ä¹ˆç†ç”±è¿™æ ·åšã€‚

ä½†å‡è®¾ä½ æƒ³æ›´æ–°æ­¤å›¾è¡¨ä»¥å“åº”ä¸æ–­å˜åŒ–çš„æ•°æ®ã€‚å¹¶ä¸”ä½ ä¸æƒ³ä»å¤´å¼€å§‹é‡æ–°ç»˜åˆ¶ï¼Œå¸Œæœ›åº”ç”¨æœ€å°çš„æ›´æ–°é›†æ¥åæ˜ æ–°æ•°æ®ã€‚ä½ å¸Œæœ›é‡ç”¨ç°æœ‰å…ƒç´ ï¼Œæ·»åŠ éœ€è¦çš„å…ƒç´ ï¼Œåˆ é™¤ä¸éœ€è¦çš„å…ƒç´ ã€‚åªéœ€å°†ä¸Šè¿°ä»£ç ç§»åŠ¨åˆ°ä¸€ä¸ªåœ¨æ•°æ®æ›´æ”¹æ—¶è°ƒç”¨çš„æ–¹æ³•ä¸­ï¼Œä½ å°±å¯ä»¥è·å¾—é«˜æ€§èƒ½çš„å¢é‡æ›´æ–°ï¼ğŸ˜²

![92-3][url-local-3]

è®©æˆ‘ä»¬æŠŠä»£ç åˆ†æä¸€ä¸‹ã€‚

*text* æ˜¯ä¸€ç»„æ–‡æœ¬å…ƒç´ ï¼Œæœ€åˆä¸ºç©ºï¼Œå…¶çˆ¶å…ƒç´ æ˜¯ SVG å…ƒç´ ã€‚è¿™ä¸ªçˆ¶é¡¹å†³å®šäº†è¾“å…¥çš„æ–‡æœ¬å…ƒç´ ç¨åå°†é™„åŠ åˆ°ä½•å¤„ã€‚

é€šè¿‡è°ƒç”¨ *selection*.data ï¼Œ*text* è¢«ç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„æ•°æ®æ•°ç»„ *letters* ã€‚è¿™å°†è®¡ç®— *text* é€‰æ‹©é›†çš„ä¸‰ä¸ªå­é›†ï¼š*enter* é€‰æ‹©é›†è¡¨ç¤ºåœ¨æ–°æ•°æ®ä¸­ï¼Œå»é™¤å·²å­˜åœ¨å…ƒç´ ä¸æ–°æ•°æ®çš„äº¤é›†ä¹‹åï¼Œå‰©ä¸‹çš„æ•°æ®ï¼›*update* é€‰æ‹©é›†è¡¨ç¤ºæ–°æ•°æ®ä¸å·²å­˜åœ¨å…ƒç´ çš„äº¤é›†ï¼›*exit* é€‰æ‹©é›†è¡¨ç¤ºåœ¨å·²å­˜åœ¨å…ƒç´ ä¸­ï¼Œå»é™¤å·²å­˜åœ¨å…ƒç´ ä¸æ–°æ•°æ®çš„äº¤é›†ä¹‹åï¼Œå‰©ä¸‹çš„å…ƒç´ ã€‚

ä½œä¸ºå›¾ç¤ºå¦‚ä¸‹ï¼š

![92-4][url-local-4]

ï¼ˆè¿™äº›é€‰æ‹©é›†éšè—åœ¨ä»£ç ä¸­ï¼š*selection*.data è¿”å› *update* é€‰æ‹©é›†ï¼Œä»ä¸­å¯ä»¥è°ƒç”¨ *selection*.enter æˆ– *selection*.exit è®¿é—®å…¶å®ƒé€‰æ‹©é›†ã€‚ï¼‰

æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¤„ç†è¿™ä¸‰ç§æƒ…å†µï¼Œä½† [selection.join][url-3] æœ¬å°±èƒ½æ–¹ä¾¿çš„å¤„ç†ã€‚*enter* é€‰æ‹©é›†æ·»åŠ è¿›æ¥ï¼›*exit* é€‰æ‹©é›†è¢«ç§»é™¤ï¼›æœ€åï¼Œ *update* å’Œ *enter* é€‰æ‹©é›†è¢«åˆå¹¶ã€æ’åºå¹¶è¿”å›ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¿™äº›åŠ å…¥æˆ–æ›´æ–°å…ƒç´ åˆ†é…å±æ€§å’Œæ–‡æœ¬ã€‚

æˆ‘ä»¬è§‚å¯Ÿåˆ°åªè¦å­—æ¯å’Œæ–‡æœ¬å…ƒç´ ä¹‹é—´çš„å…³è”ä¿æŒä¸å˜ï¼Œå°±ä¸éœ€è¦åœ¨æ›´æ–°å…ƒç´ æ—¶é‡æ–°åˆ†é…æŸäº›å±æ€§å’Œæ–‡æœ¬å†…å®¹ï¼Œè¿™æ ·å°±å¯ä»¥æ›´é«˜æ•ˆã€‚è¦ä¿ç•™æ­¤å…³è”ï¼Œ*selection*.data éœ€è¦ä¸€ä¸ªé”®å‡½æ•°ï¼›ä¸ºäº†å¯¹ *enter*ï¼Œ *update*ï¼Œ*exit* çš„ç²¾ç¡®æ“ä½œï¼Œ*selection*.join éœ€è¦ç›¸åº”çš„å‡½æ•°ã€‚å¦‚æœ update æ¯” enter å’Œ exit æ›´å¸¸è§ï¼Œè¿™å°†å¤§å¤§æé«˜æ€§èƒ½ï¼

![92-5][url-local-5]

ä¸å‰é¢ä¸€æ ·ï¼Œ*selection*.join è¿”å›åˆå¹¶çš„ enter å’Œ update é€‰æ‹©é›†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å…±äº«åº”ç”¨äºä¸¤è€…çš„ä»£ç ï¼Œä¾‹å¦‚è®¾ç½® *x* å±æ€§ã€‚

ä¼ é€’ç»™ *selection*.data çš„é”®å‡½æ•°ç”¨äºè®¡ç®—æ¯ä¸ªæ–°æ•°æ®å’Œå·²é€‰å…ƒç´ æ•°æ®çš„ï¼ˆå­—ç¬¦ä¸²ï¼‰é”®ï¼Œç¡®å®šå“ªä¸ªæ•°æ®ç»‘å®šåˆ°å“ªä¸ªå…ƒç´ ï¼šå¦‚æœå…ƒç´ å’Œæ•°æ®å…·æœ‰ç›¸åŒçš„é”®ï¼Œåˆ™è¯¥æ•°æ®ç»‘å®šåˆ°å…ƒç´ ï¼Œå¹¶ä¸”å…ƒç´ è¢«æ”¾å…¥ *update* é€‰æ‹©é›†ã€‚å­—æ¯æ˜¯å¾ˆå¥½çš„é”®ï¼Œå› æ­¤æ ‡è¯†å‡½æ•°ï¼ˆd => dï¼‰åœ¨è¿™é‡Œæ˜¯åˆé€‚çš„ã€‚

ï¼ˆå¦‚æœæœªæŒ‡å®šé”®å‡½æ•°ï¼Œåˆ™æ•°æ®ç”±ç´¢å¼•ç»‘å®šï¼šç¬¬ä¸€ä¸ªæ•°æ®ç»‘å®šåˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¾æ­¤ç±»æ¨ã€‚ä½œä¸ºç»ƒä¹ ï¼Œå°è¯•é‡å†™ä¸Šé¢çš„ä»£ç ä»¥é€šè¿‡ç´¢å¼•è”æ¥ã€‚ä½ å°†ä¼šä¹Ÿæƒ³æŠŠè®¾ç½® *x* å±æ€§ä¸è®¾ç½®æ–‡æœ¬å†…å®¹äº¤æ¢ï¼ï¼‰

ç„¶è€Œï¼Œé€‰æ‹©å™¨çœŸæ­£é—ªè€€çš„åœ°æ–¹æ˜¯è¿‡æ¸¡ï¼âœ¨

åœ¨ä¸‹é¢ï¼Œå­—æ¯ä»é¡¶éƒ¨è¿›å…¥ï¼Œæ›´æ–°æ—¶æ°´å¹³æ»‘åŠ¨ï¼Œç„¶åä»åº•éƒ¨é€€å‡ºã€‚è¿™æ¯”ä¸Šé¢çš„ç¬æ—¶è½¬å˜æ›´å®¹æ˜“ç†è§£ã€‚

![92-6][url-local-6]

å¥½çš„è¿‡æ¸¡ä¸ä»…ä»…æ˜¯ä¸ºäº†å¸å¼•æ³¨æ„åŠ›è€Œè®©å›¾è¡¨â€œèˆåŠ¨â€ï¼›å®ƒä»¬å¸®åŠ©è§‚çœ‹è€…é€šè¿‡å˜åŠ¨äº†è§£*æ•°æ®æ˜¯å¦‚ä½•å˜åŒ–çš„*ã€‚

è‰¯å¥½çš„è¿‡æ¸¡ä¿æŒ[å¯¹è±¡çš„æ’å®šæ€§][url-4]ï¼šåœ¨è¿‡æ¸¡*ä¹‹å‰*è¡¨ç¤ºç‰¹å®šäº‹ç‰©ï¼ˆå¦‚å­—æ¯ C ï¼‰çš„å›¾è¡¨å…ƒç´ åº”åœ¨æ•´ä¸ªè¿‡æ¸¡*è¿‡ç¨‹ä¸­*å’Œè¿‡æ¸¡*ä¹‹å*è¡¨ç¤ºç›¸åŒçš„äº‹ç‰©ï¼Œä»è€Œå…è®¸è§‚çœ‹è€…è¿ç»­è·Ÿè¸ªã€‚ç›¸åï¼Œå¦‚æœç»™å®šå…ƒç´ çš„å«ä¹‰åœ¨è¿‡æ¸¡æœŸé—´å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå˜åŠ¨å°†æ¯«æ— æ„ä¹‰ã€‚

ä¸¾ä¸ªæ›´å®é™…çš„ä¾‹å­æ€ä¹ˆæ ·ï¼Ÿ

ä¸‹å›¾æ˜¾ç¤ºäº†æŒ‰ç‰¹å®šå¹´é¾„ç»„äººå£ç™¾åˆ†æ¯”æ’åˆ—çš„å‰åä¸ªå·ï¼ˆä»¥åŠåç››é¡¿ç‰¹åŒºï¼Œå¤–åœ°å±…ä½è€…ï¼‰ã€‚è¿™è¡¨æ˜çŠ¹ä»–å·çš„å¹´è½»äººå£æ¯”ä¾‹è¿‡é«˜ï¼Œåæ˜ äº† LDS æ•™ä¼šå¯¹å…»è‚²å®¶åº­çš„é‡è§†ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½›ç½—é‡Œè¾¾å·é€€ä¼‘äººå£ä¼—å¤šï¼Œè®¸å¤šäººéƒ½åœ¨ 70 å²æˆ–ä»¥ä¸Šã€‚

å½“ä½ æ›´æ”¹é€‰å®šçš„å¹´é¾„ç»„æ—¶ï¼Œè¯·è§‚å¯Ÿå›¾è¡¨å¦‚ä½•é‡æ–°æ’åºä»¥åæ˜ æ’åçš„å˜åŒ–ã€‚*x* è½´åŒæ—¶é‡æ–°ç¼©æ”¾ä»¥é€‚åº”æ–°æ•°æ®ã€‚

![92-7][url-local-7]

```js
chart = {
  const svg = d3.create("svg")
      .attr("viewBox", [0, 0, width, height]);
  console.info(data)

  // For the initial render, reference the current age non-reactively.
  const agedata = viewof agedata.value;

  const x = d3.scaleLinear()
      .domain([0, d3.max(agedata, d => d.value)])
      .rangeRound([margin.left, width - margin.right]);

  const y = d3.scaleBand()
      .domain(agedata.map(d => d.name))
      .rangeRound([margin.top, margin.top + 20 * data.names.length]);

  let bar = svg.append("g")
      .attr("fill", "steelblue")
    .selectAll("rect")
    .data(agedata, d => d.name)
    .join("rect")
      .style("mix-blend-mode", "multiply")
      .attr("x", x(0))
      .attr("y", d => y(d.name))
      .attr("width", d => x(d.value) - x(0))
      .attr("height", y.bandwidth() - 1);

  const gx = svg.append("g")
      .call(xAxis, x);

  const gy = svg.append("g")
      .call(yAxis, y);

  return Object.assign(svg.node(), {
    update(agedata) {
      const t = svg.transition().duration(750);

      gx.transition(t)
          .call(xAxis, x.domain([0, d3.max(agedata, d => d.value)]));

      gy.transition(t)
          .call(yAxis, y.domain(agedata.map(d => d.name)));

      bar = bar
        .data(agedata, d => d.name)
        .call(bar => bar.transition(t)
          .attr("width", d => x(d.value) - x(0))
          .attr("y", d => y(d.name)));
    }
  });
}
```

![92-9][url-local-9]

åªæœ‰å‰ 10 æ¡å¯è§ï¼Œå› ä¸ºå…¶ä½™çš„éšè—åœ¨å›¾è¡¨ä¸‹æ–¹ã€‚å› æ­¤ï¼Œ*selection*.join æ˜¯ä¸éœ€è¦çš„ï¼Œå› ä¸ºæ²¡æœ‰æ¡å½¢åŠ å…¥æˆ–ç§»é™¤ï¼Œå®ƒä»¬åªä¼šæ›´æ–°ã€‚è¿™ä¸ä»…ç®€åŒ–äº†ä»£ç ï¼Œè€Œä¸”ä½¿è¿‡æ¸¡æ›´æœ‰æ„ä¹‰ï¼Œå› ä¸ºè¿›å…¥æˆ–é€€å‡ºæ¡å½¢å›¾çš„é€Ÿåº¦ç°åœ¨æš—ç¤ºå®ƒä»¬åœ¨å±•ç¤ºå¤–çš„ä½ç½®ã€‚

åŠ¨ç”»è¿‡æ¸¡é€šå¸¸ç”±è¯»è€…ç‚¹å‡»æˆ–åœ¨å¯»æ‰¾ç­”æ¡ˆæ—¶ç‚¹å‡»è§¦å‘ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è®©å›¾è¡¨å“åº”æ­¤ç±»æŸ¥è¯¢ã€‚
## é™„å½•

![92-10][url-local-10]

## é™„
æ ¹æ®æºç ï¼Œå»é™¤äº†å¹³å°ä¾èµ–ï¼Œæå–äº†ä¸»è¦ä»£ç ï¼Œæœ‰ä»¥ä¸‹ç¤ºä¾‹ï¼š
- [ç¤ºä¾‹ 1][url-5]
- [ç¤ºä¾‹ 2][url-6]


## <a name="reference"></a> å‚è€ƒèµ„æ–™
- [Learn D3: Joins][url-1]

[url-pre]:https://github.com/XXHolic/blog/issues/97
[url-1]:https://observablehq.com/@d3/learn-d3-joins?collection=@d3/learn-d3
[url-2]:https://observablehq.com/@d3/gallery
[url-3]:https://observablehq.com/@d3/selection-join
[url-4]:https://bost.ocks.org/mike/constancy/

[url-5]:https://xxholic.github.io/lab/blog/92/index.html
[url-6]:https://xxholic.github.io/lab/blog/92/index2.html


[url-local-1]:./images/92/1.png
[url-local-2]:./images/92/2.png
[url-local-3]:./images/92/3.png
[url-local-4]:./images/92/4.png
[url-local-5]:./images/92/5.png
[url-local-6]:./images/92/6.png
[url-local-7]:./images/92/7.png
[url-local-8]:./images/92/8.png
[url-local-9]:./images/92/9.png
[url-local-10]:./images/92/10.png

<details>
<summary>:wastebasket:</summary>

ã€Šå·«å¸ˆ 3ã€‹ä¸»çº¿å‰§æƒ…ä¸€èˆ¬éš¾åº¦å®Œæˆï¼Œæœ€åè§¦å‘çš„æ˜¯ä¸ªæ‚²å‰§ç»“å±€ã€‚

å†å»çœ‹äº†åˆ«äººçš„æ”»ç•¥ï¼Œæ‰å‘ç°å‰é¢å¾ˆå¤šä»»åŠ¡çš„é€‰æ‹©éƒ½å½±å“åˆ°äº†è¿™ä¸ªç»“å±€ã€‚

è‡ªå·±ä¹‹å‰è‡ªè®¤ä¸ºæ­£å½“çš„é€‰æ‹©ï¼Œåˆ°æœ€åå´å¯¼è‡´æ‚²å‰§æ”¶åœºã€‚

å¿ƒæƒ…è¿˜æ˜¯æœ‰äº›éƒé—·çš„ï¼Œåœ¨åšé€‰æ‹©çš„æ—¶å€™æ˜æ˜¾çš„ä»£å…¥äº†è‡ªå·±çš„æƒ³æ³•ã€‚


</details>

